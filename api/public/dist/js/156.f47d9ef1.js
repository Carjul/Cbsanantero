"use strict";(self["webpackChunkfront"]=self["webpackChunkfront"]||[]).push([[156],{1156:function(e,a,t){t.r(a),t.d(a,{default:function(){return R}});var i=t(3396),l=t(9242),o=t(7139);const s=e=>((0,i.dD)("data-v-549b1cd0"),e=e(),(0,i.Cn)(),e),r=s((()=>(0,i._)("br",null,null,-1))),n={class:"row gallery"},c={class:"col-md-11"},d={key:0,class:"col-md-4"},p={class:"input-group mb-3"},u=s((()=>(0,i._)("button",{type:"submit",class:"btn btn-primary"},"Enviar",-1))),m=["value"],g=s((()=>(0,i._)("hr",null,null,-1))),h={class:"list-group"},v={class:"list-group-item list-group-item-action active","aria-current":"true"},_=s((()=>(0,i._)("div",{class:"d-flex w-100 justify-content-between"},[(0,i._)("b",{class:"mb-1"},"Descripción:"),(0,i._)("small",null,"Costa Brisa")],-1))),f={key:0,class:"mb-1 justify-text"},G=s((()=>(0,i._)("small",null,null,-1))),y=s((()=>(0,i._)("hr",null,null,-1))),E={class:"row"},I=["onClick"],b=["onClick"],w=["src"],k={key:0,class:"modal-container"},x=["src"],C=s((()=>(0,i._)("label",{for:"prev",class:"modal-nav-btn prev"},"❮",-1))),D=s((()=>(0,i._)("label",{for:"next",class:"modal-nav-btn next"},"❯",-1)));function M(e,a,t,s,M,S){const B=(0,i.up)("center");return(0,i.wg)(),(0,i.iD)("div",null,[r,(0,i._)("div",n,[(0,i._)("div",c,[(0,i.Wm)(B,null,{default:(0,i.w5)((()=>["Vendedor"===M.customerRol&&M.customerID===M.GaleriaEnv.customer_id?((0,i.wg)(),(0,i.iD)("div",d,[(0,i._)("form",{onSubmit:a[2]||(a[2]=(0,l.iM)(((...e)=>S.crearGaleria&&S.crearGaleria(...e)),["prevent"]))},[(0,i._)("div",p,[(0,i._)("input",{type:"file",class:"form-control",accept:"image/jpeg, image/jpg, image/png",onChange:a[0]||(a[0]=(...e)=>S.uploadFile&&S.uploadFile(...e)),multiple:"",id:"imagenBar",ref:"file"},null,544),(0,i.wy)((0,i._)("input",{type:"text",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>M.GaleriaEnv.description=e),placeholder:"Descripción"},null,512),[[l.nr,M.GaleriaEnv.description]]),u])],32),null!==M.uploadProgress?((0,i.wg)(),(0,i.iD)("progress",{key:0,value:M.uploadProgress,max:"100"},null,8,m)):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])),_:1}),g,(0,i._)("div",h,[(0,i._)("div",v,[_,M.Galeria.description?((0,i.wg)(),(0,i.iD)("p",f,(0,o.zw)(M.Galeria.description),1)):(0,i.kq)("",!0),G]),y]),(0,i._)("div",E,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(M.Galeria.photos,((e,a)=>((0,i.wg)(),(0,i.iD)("div",{class:"col-md-4",key:a},[(0,i._)("div",{class:"card mb-2",onClick:a=>S.openModal(e.image)},["Vendedor"===M.customerRol&&M.customerID===M.GaleriaEnv.customer_id?((0,i.wg)(),(0,i.iD)("button",{key:0,style:{height:"50px",width:"50px"},type:"button",class:"btn btn-danger",onClick:(0,l.iM)((e=>S.eliminarFoto(M.Galeria.photos[a])),["stop"])},"X",8,b)):(0,i.kq)("",!0),(0,i._)("img",{src:e.image,class:"card-img-top gallery-image",alt:"imagen",loading:"lazy"},null,8,w)],8,I)])))),128))])]),M.modalOpen?((0,i.wg)(),(0,i.iD)("div",k,[(0,i._)("span",{class:"close-modal",onClick:a[3]||(a[3]=(...e)=>S.closeModal&&S.closeModal(...e))},"×"),(0,i._)("img",{src:M.selectedImage,class:"modal-img",alt:"Imagen agrandada"},null,8,x),(0,i._)("input",{type:"radio",id:"prev",name:"nav",class:"modal-nav-input",onClick:a[4]||(a[4]=(...e)=>S.preImage&&S.preImage(...e))}),C,(0,i._)("input",{type:"radio",id:"next",name:"nav",class:"modal-nav-input",onClick:a[5]||(a[5]=(...e)=>S.nexImage&&S.nexImage(...e))}),D])):(0,i.kq)("",!0)])])}t(560);var S=t(2492),B=t.n(S),F=t(1076),P={data(){return{file:null,customerRol:"",customerID:"",Galeria:{photos:[],negocio_id:null,status:"",customer_id:null},GaleriaEnv:{photos:[],negocio_id:null,customer_id:null,description:""},modalOpen:!1,selectedImage:null,uploadProgress:null}},methods:{uploadFile(e){this.file=e.target.files,this.GaleriaEnv.photos=[];for(let a in this.file)"object"===typeof this.file[a]&&this.GaleriaEnv.photos.push(this.file[a])},openModal(e){this.selectedImage=e,this.modalOpen=!0},closeModal(){this.modalOpen=!1},preImage(){const e=this.Galeria.photos.findIndex((e=>e.image===this.selectedImage)),a=(e-1+this.Galeria.photos.length)%this.Galeria.photos.length;this.selectedImage=this.Galeria.photos[a].image},nexImage(){const e=this.Galeria.photos.findIndex((e=>e.image===this.selectedImage)),a=(e+1)%this.Galeria.photos.length;this.selectedImage=this.Galeria.photos[a].image},async fetchGaleria(){try{const e=await F.Z.get(`http://localhost:3000/app/galeria/${this.GaleriaEnv.negocio_id}`);let a=e.data;this.Galeria={photos:a.photos,negocio_id:a.negocio_id,status:a.status,customer_id:a.customer_id,description:a.description}}catch(e){console.error("Error al obtener la galería",e)}},async crearGaleria(){try{if(null!==this.GaleriaEnv.customer_id&&null!==this.GaleriaEnv.negocio_id&&this.GaleriaEnv.photos.length>0&&""!==this.GaleriaEnv.description.trim()){const e=new FormData;for(let i=0;i<this.GaleriaEnv.photos.length;i++)e.append(`image${i}`,this.GaleriaEnv.photos[i]);e.append("description",this.GaleriaEnv.description.trim()),e.append("logitud",this.GaleriaEnv.photos.length),e.append("negocio_id",this.GaleriaEnv.negocio_id),e.append("customer_id",this.GaleriaEnv.customer_id);const a={onUploadProgress:e=>{this.uploadProgress=Math.round(100*e.loaded/e.total)}},t=await F.Z.post("http://localhost:3000/app/galeria",e,a);console.log(t),202===t.status&&(this.GaleriaEnv.photos=[],this.GaleriaEnv.description="",this.fetchGaleria())}else alert("Asegúrate de completar la descripción y tener las credenciales para subir fotos"),console.log(this.GaleriaEnv)}catch(e){console.error("Error al crear la galería:",e)}finally{this.uploadProgress=null}},async eliminarFoto(e){const a=await B().fire({title:"¿Quieres eliminar esta imagen?",text:"No podrás revertir esto",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar"});if(a.isConfirmed)try{const a=await F.Z.put(`http://localhost:3000/app/galeria/${e.id}`,{photo:e.image});console.log(a),this.fetchGaleria(),B().fire({title:"Eliminada",text:"La imagen ha sido eliminada exitosamente.",icon:"success"})}catch(t){console.error("Error al eliminar la foto:",t)}else console.log("Solicitud cancelada")}},created(){this.GaleriaEnv.customer_id=localStorage.getItem("customerId"),this.GaleriaEnv.negocio_id=localStorage.getItem("negocioId"),this.customerRol=localStorage.getItem("usuarioRol"),this.customerID=localStorage.getItem("customerNegocioId")},mounted(){this.fetchGaleria()}},j=t(89);const q=(0,j.Z)(P,[["render",M],["__scopeId","data-v-549b1cd0"]]);var R=q}}]);
//# sourceMappingURL=156.f47d9ef1.js.map